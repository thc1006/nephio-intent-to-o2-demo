#!/bin/bash
set -euo pipefail

source scripts/env.sh

echo "========================================="
echo "Gitea Web UI 替代方案"
echo "========================================="
echo ""
echo "由於 SSH tunnel 被禁用，你有以下選擇："
echo ""
echo "1. 使用 CLI 工具操作："
echo "   bash scripts/gitea_cli_operations.sh"
echo ""
echo "2. 使用 curl/API 直接操作"
echo ""
echo "3. 安裝輕量級 Web 終端 (gotty)："
echo "   sudo apt-get install -y golang-go"
echo "   go install github.com/yudai/gotty@latest"
echo "   ~/go/bin/gotty -w -p 8080 bash"
echo "   然後可能可以從外部訪問 http://172.16.0.78:8080"
echo ""
echo "4. 使用 ngrok 建立公開隧道："
echo "   wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz"
echo "   tar xzf ngrok-v3-stable-linux-amd64.tgz"
echo "   ./ngrok http 8888"
echo "   會得到一個 https://xxx.ngrok.io 的公開網址"
echo ""
echo "5. 檢查你的 SSH client 設定："
echo "   在你的筆電 ~/.ssh/config 加入："
echo "   Host your-vm"
echo "     HostName [VM-IP]"
echo "     User ubuntu"
echo "     LocalForward 8888 localhost:8888"
echo ""

echo "========================================="
echo "目前 Gitea 資訊："
echo "========================================="
echo "API URL: $GITEA_URL"
echo "Token: ${GITEA_TOKEN:0:10}..."
echo "User: gitops-admin"
echo ""
echo "Repository 列表："
curl -s -H "Authorization: token $GITEA_TOKEN" \
    "${GITEA_URL}/api/v1/user/repos" 2>/dev/null | \
    jq -r '.[] | "- \(.name) (\(.visibility))"' || echo "無法取得"

echo ""
echo "你可以使用 git 直接操作："
echo "git clone http://gitops-admin:${GITEA_TOKEN}@${GITEA_URL#http://}/gitops-admin/edge1-config.git"