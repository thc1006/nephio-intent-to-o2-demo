# RootSync configuration for Edge1 cluster
# Deploy this to the edge1 cluster (VM-2: 172.16.4.45)
#
# Prerequisites:
# 1. Config Sync operator installed on edge1 cluster
# 2. Git credentials configured if using private repo
# 3. Proper RBAC permissions for sync
#
apiVersion: configsync.gke.io/v1beta1
kind: RootSync
metadata:
  name: edge1-root-sync
  namespace: config-management-system
spec:
  sourceType: git
  sourceFormat: unstructured
  git:
    repo: https://github.com/your-org/nephio-intent-to-o2-demo
    branch: main
    dir: gitops/edge1-config
    period: 30s
    auth: none  # Change to 'ssh' or 'token' for private repos
    # secretRef:
    #   name: git-creds  # Create secret with git credentials if needed
  override:
    apiServerEndpoint: https://172.16.4.45:6443
    clusterName: edge1
    metadata:
      labels:
        site: edge1
        managed-by: config-sync
      annotations:
        config.nephio.org/sync-time: "30s"
        config.nephio.org/site: "edge1"
---
# ClusterRole for edge1 sync permissions
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: edge1-sync-role
rules:
- apiGroups: ["*"]
  resources: ["*"]
  verbs: ["*"]
---
# ClusterRoleBinding for edge1 sync
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: edge1-sync-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: edge1-sync-role
subjects:
- kind: ServiceAccount
  name: root-reconciler
  namespace: config-management-system